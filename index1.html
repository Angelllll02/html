<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Escape del Laberinto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: linear-gradient(135deg, #2c3e50, #3498db, #8e44ad);
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 820px;
      margin: 40px auto;
      background: rgba(44, 62, 80, 0.93);
      border-radius: 16px;
      box-shadow: 0 6px 32px rgba(0,0,0,0.3);
      padding: 30px 40px;
    }
    h1 {
      text-align: center;
      font-size: 2.7rem;
      letter-spacing: 2px;
      margin-top: 0;
    }
    .instructions {
      background: rgba(52, 152, 219, 0.13);
      border-left: 4px solid #2980b9;
      padding: 16px 26px;
      margin-bottom: 20px;
      border-radius: 10px;
      font-size: 1.08rem;
    }
    #gameCanvas {
      display: block;
      margin: 0 auto 20px auto;
      background: #222;
      border-radius: 12px;
      box-shadow: 0 0 18px rgba(52,152,219,0.5);
      border: 3px solid #8e44ad;
    }
    .info-bar {
      display: flex;
      justify-content: space-between;
      font-size: 1.13rem;
      margin-bottom: 16px;
    }
    #restartBtn {
      background: #27ae60;
      border: none;
      color: #fff;
      font-weight: bold;
      padding: 10px 22px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(39,174,96,0.16);
      cursor: pointer;
      transition: background 0.2s;
    }
    #restartBtn:hover {
      background: #219150;
    }
    #victoryMsg {
      display: none;
      text-align: center;
      font-size: 1.8rem;
      padding: 14px;
      margin-top: 10px;
      background: rgba(39,174,96,0.17);
      border-radius: 10px;
      color: #27ae60;
      border: 2px solid #27ae60;
      animation: pop 0.7s;
    }
    @keyframes pop {
      0% { transform: scale(0.2);}
      70% { transform: scale(1.08);}
      100% { transform: scale(1);}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß© Escape del Laberinto üß©</h1>
    <div class="instructions">
      <strong>¬°Bienvenido al Escape del Laberinto!</strong><br>
      Tu misi√≥n es guiar al <span style="color:#f1c40f;">explorador</span> hasta la <span style="color:#e74c3c;">meta</span> en el menor tiempo posible. <br>
      <ul>
        <li>Usa las <b>flechas</b> del teclado (<kbd>‚Üë</kbd>, <kbd>‚Üì</kbd>, <kbd>‚Üê</kbd>, <kbd>‚Üí</kbd>) para moverte.</li>
        <li>Evita las paredes del laberinto.</li>
        <li>¬°Intenta batir tu r√©cord de velocidad!</li>
        <li>Pulsa <b>Reiniciar</b> para un nuevo laberinto.</li>
      </ul>
    </div>
    <div class="info-bar">
      <div>‚è±Ô∏è Tiempo: <span id="timer">0.00</span>s</div>
      <div>üèÜ R√©cord: <span id="bestScore">---</span>s</div>
      <button id="restartBtn">Reiniciar</button>
    </div>
    <canvas id="gameCanvas" width="640" height="640"></canvas>
    <div id="victoryMsg"></div>
  </div>
  <audio id="winSound" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b4be7c4c.mp3"></audio>
  <script>
    // Laberinto y juego
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const size = 20; // 20x20 celdas
    const cellSize = canvas.width / size;
    let maze = [];
    let player = {x: 0, y: 0};
    let goal = {x: size-1, y: size-1};
    let startTime = null;
    let elapsed = 0;
    let finished = false;
    let timerIntv = null;
    let bestScore = localStorage.getItem('mazeBestScore') || null;

    // Laberinto: Algoritmo DFS
    function genMaze() {
      maze = Array(size).fill().map(() =>
        Array(size).fill().map(() => ({
          top: true, right: true, bottom: true, left: true, visited: false
        }))
      );
      function walk(x, y) {
        maze[y][x].visited = true;
        const dirs = ['up','down','left','right'];
        for (let i = dirs.length - 1; i > 0; i--) {
          let j = Math.floor(Math.random() * (i + 1));
          [dirs[i], dirs[j]] = [dirs[j], dirs[i]];
        }
        for (let dir of dirs) {
          let nx = x, ny = y;
          if (dir == 'up') ny--;
          if (dir == 'down') ny++;
          if (dir == 'left') nx--;
          if (dir == 'right') nx++;
          if (nx >= 0 && nx < size && ny >= 0 && ny < size && !maze[ny][nx].visited) {
            if (dir == 'up') maze[y][x].top = maze[ny][nx].bottom = false;
            if (dir == 'down') maze[y][x].bottom = maze[ny][nx].top = false;
            if (dir == 'left') maze[y][x].left = maze[ny][nx].right = false;
            if (dir == 'right') maze[y][x].right = maze[ny][nx].left = false;
            walk(nx, ny);
          }
        }
      }
      walk(0, 0);
      player = {x: 0, y: 0};
      goal = {x: size-1, y: size-1};
      finished = false;
      elapsed = 0;
      startTime = null;
      document.getElementById('victoryMsg').style.display = 'none';
      updateBest();
      draw();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Fondo animado
      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          ctx.fillStyle = ((x+y)%2==0) ? '#2c3e50' : '#34495e';
          ctx.fillRect(x*cellSize, y*cellSize, cellSize, cellSize);
        }
      }
      // Laberinto
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 2;
      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          let c = maze[y][x];
          let px = x * cellSize, py = y * cellSize;
          if (c.top) {
            ctx.beginPath();
            ctx.moveTo(px, py);
            ctx.lineTo(px+cellSize, py);
            ctx.stroke();
          }
          if (c.left) {
            ctx.beginPath();
            ctx.moveTo(px, py);
            ctx.lineTo(px, py+cellSize);
            ctx.stroke();
          }
          if (c.bottom) {
            ctx.beginPath();
            ctx.moveTo(px, py+cellSize);
            ctx.lineTo(px+cellSize, py+cellSize);
            ctx.stroke();
          }
          if (c.right) {
            ctx.beginPath();
            ctx.moveTo(px+cellSize, py);
            ctx.lineTo(px+cellSize, py+cellSize);
            ctx.stroke();
          }
        }
      }
      // Meta
      ctx.save();
      ctx.shadowColor = "#e74c3c";
      ctx.shadowBlur = 12;
      ctx.fillStyle = "#e74c3c";
      ctx.beginPath();
      ctx.arc((goal.x+0.5)*cellSize, (goal.y+0.5)*cellSize, cellSize/3, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
      ctx.font = "bold 1.1rem Arial";
      ctx.fillStyle = "#fff";
      ctx.fillText("META", (goal.x+0.1)*cellSize, (goal.y+0.85)*cellSize);

      // Jugador (personaje animado)
      ctx.save();
      ctx.shadowColor = "#f1c40f";
      ctx.shadowBlur = 12;
      ctx.beginPath();
      ctx.arc((player.x+0.5)*cellSize, (player.y+0.5)*cellSize, cellSize/2.5, 0, Math.PI*2);
      ctx.fillStyle = "#f1c40f";
      ctx.fill();
      ctx.restore();

      // Carita feliz
      ctx.save();
      ctx.translate((player.x+0.5)*cellSize, (player.y+0.5)*cellSize);
      ctx.beginPath();
      ctx.arc(0,0,cellSize/4,0,Math.PI*2);
      ctx.fillStyle="#fff";
      ctx.fill();
      ctx.beginPath();
      ctx.arc(-cellSize/10,-cellSize/10,cellSize/30,0,Math.PI*2);
      ctx.arc(cellSize/10,-cellSize/10,cellSize/30,0,Math.PI*2);
      ctx.fillStyle="#333";
      ctx.fill();
      ctx.beginPath();
      ctx.arc(0,cellSize/15,cellSize/10,0,Math.PI);
      ctx.strokeStyle="#333";
      ctx.lineWidth=2;
      ctx.stroke();
      ctx.restore();
    }

    function move(dx, dy) {
      if (finished) return;
      let x = player.x, y = player.y;
      let cell = maze[y][x];
      if (dx == -1 && !cell.left) x--;
      if (dx == 1 && !cell.right) x++;
      if (dy == -1 && !cell.top) y--;
      if (dy == 1 && !cell.bottom) y++;
      if (x >= 0 && x < size && y >= 0 && y < size) {
        player.x = x;
        player.y = y;
        if (!startTime) {
          startTime = Date.now();
          timerIntv = setInterval(updateTimer, 30);
        }
        draw();
        checkGoal();
      }
    }

    function updateTimer() {
      if (finished || !startTime) return;
      elapsed = (Date.now() - startTime) / 1000;
      document.getElementById('timer').textContent = elapsed.toFixed(2);
    }
    function updateBest() {
      if (bestScore) {
        document.getElementById('bestScore').textContent = Number(bestScore).toFixed(2);
      } else {
        document.getElementById('bestScore').textContent = "---";
      }
    }

    function checkGoal() {
      if (player.x === goal.x && player.y === goal.y) {
        finished = true;
        clearInterval(timerIntv);
        document.getElementById('timer').textContent = elapsed.toFixed(2);
        let winMsg = document.getElementById('victoryMsg');
        winMsg.innerHTML = `üéâ ¬°Felicidades! Escapaste en <b>${elapsed.toFixed(2)}s</b> üéâ`;
        winMsg.style.display = 'block';
        document.getElementById('winSound').play();
        if (!bestScore || elapsed < bestScore) {
          bestScore = elapsed;
          localStorage.setItem('mazeBestScore', bestScore);
          winMsg.innerHTML += "<br><span style='color:#f1c40f;'>¬°Nuevo r√©cord!</span>";
        }
        updateBest();
      }
    }

    document.addEventListener('keydown', e => {
      if (e.key == 'ArrowUp') move(0,-1);
      if (e.key == 'ArrowDown') move(0,1);
      if (e.key == 'ArrowLeft') move(-1,0);
      if (e.key == 'ArrowRight') move(1,0);
    });

    document.getElementById('restartBtn').onclick = () => {
      clearInterval(timerIntv);
      genMaze();
      document.getElementById('timer').textContent = "0.00";
    };

    // Iniciar juego
    genMaze();
  </script>
</body>
</html>