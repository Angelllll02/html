<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Científica Avanzada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #191a23;
      --panel: #282a36;
      --panel-light: #f5f5fa;
      --accent: #8e44ad;
      --accent2: #3498db;
      --accent3: #27ae60;
      --danger: #e74c3c;
      --button-radius: 16px;
      --shadow: 0 8px 40px rgba(44, 62, 80, 0.17);
      --font: 'Segoe UI', Arial, sans-serif;
    }
    body {
      background: var(--bg);
      color: #fff;
      font-family: var(--font);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }
    .container {
      max-width: 390px;
      margin: 40px auto;
      background: var(--panel);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 28px 26px 24px 26px;
      border: 2px solid var(--accent2);
    }
    h1 {
      text-align: center;
      font-size: 2.2rem;
      margin-top: 0;
      letter-spacing: 1.5px;
      color: var(--accent2);
      text-shadow: 0 2px 6px #0003;
    }
    .mode-toggle {
      float: right;
      font-size: 1.1rem;
      background: var(--accent2);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 6px 18px;
      cursor: pointer;
      margin-bottom: 18px;
      transition: background 0.2s;
    }
    .mode-toggle:hover {
      background: var(--accent);
    }
    .display {
      background: #22223a;
      color: #f1f1f7;
      border-radius: 12px;
      box-shadow: 0 2px 12px #0002;
      padding: 18px 12px 8px 12px;
      font-size: 1.35rem;
      min-height: 50px;
      margin-bottom: 10px;
      word-break: break-all;
      letter-spacing: 1.1px;
      position: relative;
    }
    .subdisplay {
      font-size: 1.09rem;
      color: #b7b8d8;
      min-height: 21px;
      margin-bottom: 5px;
      text-align: right;
      letter-spacing: 0.8px;
    }
    .button-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin-bottom: 18px;
    }
    button {
      font-size: 1.17rem;
      padding: 10px 0;
      border: none;
      border-radius: var(--button-radius);
      background: linear-gradient(135deg, #35346c, var(--accent2));
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px #0002;
      transition: background 0.22s, transform 0.13s;
      outline: none;
    }
    button:active {
      background: linear-gradient(135deg, var(--accent2), #35346c);
      transform: scale(0.97);
    }
    button.func {
      background: linear-gradient(135deg, #2c3e50, var(--accent));
      color: #ffe4fa;
    }
    button.op {
      background: linear-gradient(135deg, #282a36, var(--accent3));
      color: #eafaea;
    }
    button.res {
      background: linear-gradient(135deg, var(--accent3), #27ae60);
      color: #fff;
      font-size: 1.15rem;
      font-weight: bold;
      box-shadow: 0 2px 16px #27ae6033;
    }
    button.clear {
      background: linear-gradient(135deg, var(--danger), #c0392b);
      color: #fff;
    }
    .history {
      background: #21222c;
      color: #b7b8d8;
      border-radius: 11px;
      max-height: 85px;
      overflow-y: auto;
      font-size: 0.99rem;
      padding: 10px 12px;
      margin-bottom: 14px;
      box-shadow: 0 1px 10px #0002;
    }
    .history-title {
      color: var(--accent3);
      font-size: 1.08rem;
      margin-bottom: 4px;
      font-weight: bold;
    }
    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .history-list li {
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }
    .history-list li:hover {
      color: var(--accent2);
      text-decoration: underline;
    }
    .footer {
      text-align: center;
      font-size: 0.97rem;
      margin-top: 8px;
      color: #b7b8d8;
      opacity: 0.8;
      padding-bottom: 10px;
    }
    /* Light mode */
    body.light {
      background: var(--panel-light);
      color: #272a24;
    }
    body.light .container {
      background: var(--panel-light);
      border: 2px solid var(--accent);
      box-shadow: 0 8px 36px #8e44ad22;
    }
    body.light .display {
      background: #fff;
      color: #272a24;
    }
    body.light .subdisplay {
      color: #666;
    }
    body.light .history {
      background: #f3f3f9;
      color: #272a24;
      box-shadow: 0 2px 12px #3498db12;
    }
    body.light button {
      background: linear-gradient(135deg, #f4f6fa, var(--accent2));
      color: #272c34;
      box-shadow: 0 2px 10px #3498db13;
    }
    body.light button.func {
      background: linear-gradient(135deg, #f4f6fa, var(--accent));
      color: #8e44ad;
    }
    body.light button.op {
      background: linear-gradient(135deg, #f4f6fa, var(--accent3));
      color: #27ae60;
    }
    body.light button.res {
      background: linear-gradient(135deg, #27ae60, var(--accent3));
      color: #fff;
      box-shadow: 0 2px 16px #27ae6022;
    }
    body.light button.clear {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="mode-toggle" id="modeBtn">🌙 Modo Oscuro</button>
    <h1>Calculadora Científica</h1>
    <div class="display">
      <div class="subdisplay" id="subdisplay">&nbsp;</div>
      <span id="mainDisplay">0</span>
    </div>
    <div class="history">
      <div class="history-title">Historial</div>
      <ul class="history-list" id="historyList"></ul>
    </div>
    <div class="button-grid" id="buttonGrid">
      <!-- Botones generados por JS -->
    </div>
    <div class="footer">
      Elaborada por <span style="color:var(--accent);font-weight:600;">Angelllll02</span> &mdash; <span style="color:var(--accent2);">2025</span>
      <br>
      <span style="font-size:0.93rem;">Funciones: +, −, ×, ÷, ^, √, %, trigonométricas, log, ln, factorial, π, e, parentesis y más.</span>
    </div>
  </div>
  <script>
    // Botones de la calculadora
    const btns = [
      // Fila 1
      {txt:'(', val:'(', type:'func'}, {txt:')', val:')', type:'func'}, {txt:'π', val:'pi', type:'func'}, {txt:'e', val:'e', type:'func'}, {txt:'AC', val:'ac', type:'clear'},
      // Fila 2
      {txt:'sin', val:'sin(', type:'func'}, {txt:'cos', val:'cos(', type:'func'}, {txt:'tan', val:'tan(', type:'func'}, {txt:'ln', val:'ln(', type:'func'}, {txt:'log', val:'log(', type:'func'},
      // Fila 3
      {txt:'x²', val:'^2', type:'func'}, {txt:'xʸ', val:'^', type:'func'}, {txt:'√', val:'sqrt(', type:'func'}, {txt:'%', val:'%', type:'func'}, {txt:'n!', val:'!', type:'func'},
      // Fila 4
      {txt:'7', val:'7'}, {txt:'8', val:'8'}, {txt:'9', val:'9'}, {txt:'÷', val:'/', type:'op'}, {txt:'DEL', val:'del', type:'clear'},
      // Fila 5
      {txt:'4', val:'4'}, {txt:'5', val:'5'}, {txt:'6', val:'6'}, {txt:'×', val:'*', type:'op'}, {txt:'Ans', val:'ans', type:'func'},
      // Fila 6
      {txt:'1', val:'1'}, {txt:'2', val:'2'}, {txt:'3', val:'3'}, {txt:'−', val:'-', type:'op'}, {txt:'EXP', val:'exp(', type:'func'},
      // Fila 7
      {txt:'0', val:'0'}, {txt:'.', val:'.'}, {txt:'+⁄−', val:'neg', type:'func'}, {txt:'+','val':'+', type:'op'}, {txt:'=', val:'=', type:'res'}
    ];
    // Generar botones
    const grid = document.getElementById('buttonGrid');
    btns.forEach(b => {
      const btn = document.createElement('button');
      btn.textContent = b.txt;
      if (b.type) btn.classList.add(b.type);
      btn.dataset.val = b.val;
      grid.appendChild(btn);
    });

    // Modo claro/oscuro
    const modeBtn = document.getElementById('modeBtn');
    modeBtn.onclick = () => {
      document.body.classList.toggle('light');
      modeBtn.textContent = document.body.classList.contains('light') ? "🌞 Modo Claro" : "🌙 Modo Oscuro";
    };

    // Variables
    let expr = '';
    let ans = 0;
    let lastResult = 0;
    let history = [];
    const mainDisplay = document.getElementById('mainDisplay');
    const subdisplay = document.getElementById('subdisplay');
    const historyList = document.getElementById('historyList');

    // Mostrar historial
    function renderHistory() {
      historyList.innerHTML = '';
      history.slice(-6).reverse().forEach((h, i) => {
        const li = document.createElement('li');
        li.textContent = h.expr + ' = ' + h.res;
        li.onclick = () => {
          expr = h.expr;
          updateDisplay();
        };
        historyList.appendChild(li);
      });
    }
    // Actualizar display
    function updateDisplay() {
      mainDisplay.textContent = expr ? expr : '0';
      subdisplay.textContent = '';
    }
    updateDisplay();

    // Evaluador extendido
    function safeEval(expression) {
      try {
        let exp = expression.replace(/pi/g, Math.PI)
                            .replace(/e/g, Math.E)
                            .replace(/ans/g, ans)
                            .replace(/÷/g, '/')
                            .replace(/×/g, '*')
                            .replace(/−/g, '-')
                            .replace(/%/g, '/100');
        // Funciones matemáticas
        exp = exp.replace(/sin\(/g, 'Math.sin(')
                 .replace(/cos\(/g, 'Math.cos(')
                 .replace(/tan\(/g, 'Math.tan(')
                 .replace(/sqrt\(/g, 'Math.sqrt(')
                 .replace(/ln\(/g, 'Math.log(')
                 .replace(/log\(/g, 'Math.log10(')
                 .replace(/exp\(/g, 'Math.exp(');
        // Potencias
        exp = exp.replace(/(\d+|\w+|\([^()]*\))\^(\d+|\w+|\([^()]*\))/g, 'Math.pow($1,$2)');
        // Factorial
        exp = exp.replace(/(\d+|\w+|\([^()]*\))\!/g, 'factorial($1)');
        // Negativo
        exp = exp.replace(/neg([0-9\.]+)/g, '-$1');
        // Redondear decimales
        let result = Function('factorial', 'return '+exp)(factorial);
        if (typeof result === 'number' && !isNaN(result)) {
          return Math.round(result*1000000000)/1000000000;
        }
        return 'Error';
      } catch {
        return 'Error';
      }
    }
    // Factorial
    function factorial(n) {
      n = Number(n);
      if (n < 0) return NaN;
      if (n === 0 || n === 1) return 1;
      let res = 1;
      for (let i=2; i<=n; i++) res *= i;
      return res;
    }

    // Botón pulsado
    grid.addEventListener('click', e => {
      if (!e.target.matches('button')) return;
      const val = e.target.dataset.val;
      if (!val) return;
      if (val === 'ac') {
        expr = '';
        subdisplay.textContent = '';
        updateDisplay();
        return;
      }
      if (val === 'del') {
        expr = expr.slice(0, -1);
        updateDisplay();
        return;
      }
      if (val === '=') {
        if (!expr) return;
        let res = safeEval(expr);
        mainDisplay.textContent = res;
        subdisplay.textContent = expr;
        if (res !== 'Error') {
          ans = res;
          history.push({expr, res});
          renderHistory();
          lastResult = res;
        }
        expr = '';
        return;
      }
      if (val === 'neg') {
        // Cambiar el signo del último número
        expr = expr.replace(/(\d+\.?\d*)$/, function(m) {
          return m[0]==='-' ? m.slice(1) : '-'+m;
        });
        updateDisplay();
        return;
      }
      if (val === 'ans') {
        expr += 'ans';
        updateDisplay();
        return;
      }
      // Evita doble operador o doble punto
      if (val === '.' && expr.endsWith('.')) return;
      if (['+', '-', '*', '/', '^'].includes(val) && expr.endsWith(val)) return;
      expr += val;
      updateDisplay();
    });

    // Teclado físico
    document.addEventListener('keydown', e => {
      const map = {
        'Enter':'=','=':'=','+':'+','-':'-','*':'*','/':'/',
        'Backspace':'del','Delete':'ac','(':'(','[':'(','{':'(','0':'0','1':'1','2':'2','3':'3','4':'4','5':'5','6':'6','7':'7','8':'8','9':'9','.':'.'
      };
      if (map[e.key]) {
        const btn = [...grid.children].find(b => b.dataset.val === map[e.key]);
        if (btn) btn.click();
      }
    });

    // Inicializar historial si existe en localStorage
    if (localStorage.getItem('calcHistory')) {
      history = JSON.parse(localStorage.getItem('calcHistory'));
      renderHistory();
    }
    // Guardar historial al actualizar
    window.addEventListener('beforeunload', () => {
      localStorage.setItem('calcHistory', JSON.stringify(history));
    });
  </script>
</body>
</html>